# SyncTerm-IDE v2.2.2 — Release Notes

## Highlights
- **Watcher 検出の安定化**：レジストリ上書き問題を修正。複数 Watcher がある環境で **1つしか表示されない／`*.json` が名前として出てしまう** 不具合を解消しました。

## Added
- なし

## Changed
- **watcher_manager.sh（レジストリ同期）**
  - ハートビートの同期を **「ディレクトリ丸ごと」ではなく**、**`<WATCHER_ID>.json` 単体**の rsync に変更。
  - レジストリ同期で **`--delete` を使用しない**方針に変更（他の Watcher の JSON を消してしまうのを防止）。
  - レジストリファイルの命名を **`<id>.json` に統一**。

- **GUI（Watcher 一覧の構築）**
  - `_registry/*.json` の **JSON 以外や不正ファイルをスキップ**し、**JSON decode エラーも安全に無視**。
  - 表示名（`display_name`）は JSON から、内部 ID は **ファイル名の stem（拡張子除去）**を使用。
  - タイムアウト（heartbeat）に基づいて **オフライン Watcher を除外**、選択中の項目は可能な限り保持。

## Fixed
- **複数 Watcher の上書き問題**：レジストリ同期時に他の JSON を上書き／削除してしまい、**一覧に 1 台しか出ない**ことがある不具合を修正。
- **`*.json` がセッションとして扱われる問題**：GUI が `rtx5090.json` をセッションディレクトリと誤認しようとするケースを抑止（ID は常に stem を使用）。
- **エラー 23（rsync）**：`/sessions/<watcher_id>.json/` のような **誤ったパス**に同期しに行く動作を回避。

## Migration
- **両方更新してください**：`watcher_manager.sh` と `gui_terminal.py` を v2.2.2 相当へ更新。
- サーバの `base_path/_registry/` に古い形式のファイルが残っていれば削除（または放置可。新方式が優先されます）。
- `WATCHER_ID` が **ユニーク**であることを確認してください。

## Notes
- **OS の検証状況**：主対象は **macOS**。**Windows / Linux は未検証**です（挙動差がある可能性）。
- **Watcher ログ出力の仕様**：Watcher は**実行中の出力を逐次送らず、完了後にまとめて** `commands.log` へ書き込みます。途中経過は GUI のターミナルに表示されません。

## Links
- 変更履歴は **[CHANGELOG.md](CHANGELOG.md)** を参照。
