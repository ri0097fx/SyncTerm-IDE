# SyncTerm-IDE v2.3.0

## Highlights
- **Safe multi-link save**: 保存ごとに一意トークンを発行し、`<session>/.staged_uploads/<token>` → `_internal_move_staged_file::<token>::<relpath>` で **一対一**に適用。
- **Atomic replace**: Watcher は `copy2 → os.replace` で安全に置換、**途中取得や同時実行でも破損しない**。
- **Path validation**: 絶対/`..` を拒否してセッション外への書き込みを防止。

## Breaking changes
- 旧形式 `"_internal_move_staged_file::<relpath>"` と単一 `.staged_for_upload` を**廃止**（Watcher は受理しません）。
- `.commands.offset` は **Watcher が正**。GUI/manager の pull 対象から外してください。

## Changes
- GUI: リンク経由ファイルのローカルキャッシュを **watcher/session/link/相対パス** で一意化。
- GUI: 保存後のアップロードをトークン化し、適用コマンドもトークン付きに変更。
- Watcher: 原子的置換＋パス検証。  
- Manager: pull フィルタに `*/.staged_uploads/**` を追加（必要なら `*/.staged_for_upload` 互換も可）。`.commands.offset` は除外。

## Migration guide
1. GUI を v2.3.0 以降に更新（保存時にトークンを使う実装）。
2. `watcher_manager.sh` の rsync pull 設定に  
   `--include '*/.staged_uploads/**'` を追加、`.commands.offset` は除外のまま。
3. 旧形式のコマンド送出（`_internal_move_staged_file::<relpath>`）が残っていないか確認。

## Notes
- 主対象は **macOS**。**Windows/Linux は未検証**です。
